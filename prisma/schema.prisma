generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String         @id @default(uuid())
  email           String         @unique
  password        String
  role            UserRole       @default(USER)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  phone           String
  name            String
  addresses       Address[]
  cart            Cart?
  orders          Order[]
  orderedProducts OrderProduct[]
  Wishlist        Wishlist[]
}

model Cart {
  id        String     @id @default(uuid())
  userId    String     @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  User      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     CartItem[]
}

model CartItem {
  id        String   @id @default(uuid())
  quantity  Int
  cartId    String
  productId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([cartId, productId])
}

model Address {
  id            String   @id @default(uuid())
  phone         String
  country       String
  governorate   String
  city          String
  streetAddress String
  userId        String
  label         String
  name          String
  createdAt     DateTime @default(now())
  isDefault     Boolean  @default(false)
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, label])
}

model Wishlist {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
}

model Product {
  id                 String         @id @default(cuid())
  title              String         @unique
  description        String
  brandId            String?
  price              Float
  discountPercentage Float?
  rating             Float
  stock              Int
  limit              Int?
  images             String[]
  thumbnail          String
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  finalPrice         Float
  CartItems          CartItem[]
  orderItems         OrderProduct[]
  brand              Brand?         @relation(fields: [brandId], references: [id])
  Wishlist           Wishlist[]
  categories         Category[]     @relation("ProductCategories")
}

model Category {
  id                String     @id @default(uuid())
  name              String     @unique
  slug              String     @unique
  nameAsSubcategory String
  thumbnail         String
  parentCategoryId          String?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  parentCategory    Category?  @relation("CategoryToCategory", fields: [parentCategoryId], references: [id])
  subcategories     Category[] @relation("CategoryToCategory")
  brands            Brand[]    @relation("BrandToCategory")
  products          Product[]  @relation("ProductCategories")

  @@index([slug])
}

model Brand {
  id         String     @id @default(uuid())
  name       String     @unique
  slug       String     @unique
  thumbnail  String?
  products   Product[]
  categories Category[] @relation("BrandToCategory")

  @@index([slug])
}

model Order {
  id            String         @id @default(uuid())
  status        OrderStatus    @default(PENDING)
  itemsCount    Int
  shippingFee   Float
  totalPrice    Float
  userPhone     String
  country       String
  governorate   String
  city          String
  streetAddress String
  userId        String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  userName      String
  subtotal      Float
  count         Int            @default(autoincrement())
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  products      OrderProduct[]
}

model OrderProduct {
  id        String  @id @default(cuid())
  quantity  Int
  orderId   String
  userId    String
  productId String
  price     Float
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum UserRole {
  USER
  ADMIN
}

enum OrderStatus {
  CANCELLED
  PENDING
  COMPLETED
}
