generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String         @id @default(uuid())
  email           String         @unique
  name            String
  phone           String
  password        String
  role            UserRole       @default(USER)

  addresses       Address[]

  cart            Cart?

  Wishlist        Wishlist[]

  orders          Order[]

  orderedProducts OrderProduct[]

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
}

model Cart {
  id        String       @id @default(uuid())

  items     CartItem[]

  User      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String       @unique

  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model CartItem {
  id        String   @id @default(uuid())

  quantity  Int

  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  cartId    String

  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String

  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@unique([cartId, productId])
}

model Address {
  id            String         @id @default(uuid())
  name          String
  label         String
  phone         String
  country       String
  governorate   String
  city          String
  streetAddress String
  default       Boolean        @default(false)

  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@unique([userId, label])
}

model Wishlist {
  id        String   @id @default(cuid())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String

  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String

  createdAt DateTime @default(now())

  @@unique([userId, productId])
}

model Product {
  id                  String        @id @default(cuid())
  title               String        @unique
  description         String
  thumbnail           String
  images              String[]
  price               Float
  discountPercentage  Float?
  finalPrice          Float
  rating              Float
  stock               Int
  limit               Int?

  categories          Category[]    @relation("ProductCategories")

  brand               Brand?        @relation(fields: [brandId], references: [id], onDelete: SetNull)
  brandId             String?

  CartItems           CartItem[]

  Wishlist            Wishlist[]

  orderItems          OrderProduct[]

  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
}

model Category {
  id              String        @id @default(uuid())
  name            String        @unique
  slug            String        @unique
  subCategoryName String
  thumbnail       String

  products        Product[]     @relation("ProductCategories")

  parent          Category?     @relation("CategoryToCategory", fields: [parentId], references: [id], onDelete: SetNull)
  parentId        String?

  children        Category[]    @relation("CategoryToCategory")

  brands          Brand[]

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([slug])
}

model Brand {
  id         String    @id @default(uuid())
  name       String    @unique
  slug       String    @unique
  thumbnail  String?

  products   Product[]

  categories Category[]

  @@index([slug])
}

model Order {
  id            String         @id @default(uuid())
  count         Int            @default(autoincrement())
  status        OrderStatus    @default(PENDING)
  itemsCount    Int
  subtotal      Float
  shippingFee   Float
  totalPrice    Float
  userName      String
  userPhone     String
  country       String
  governorate   String
  city          String
  streetAddress String

  products      OrderProduct[]

  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model OrderProduct {
  id        String   @id @default(cuid())
  quantity  Int
  price     Float

  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId   String

  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String

  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String
}

enum UserRole {
  USER
  ADMIN
}

enum OrderStatus {
  CANCELLED
  PENDING
  COMPLETED
}